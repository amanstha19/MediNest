<!doctype html>
<html>
  <head>
    <title>MediNest Dashboard</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.css"
    />
    <style>
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }
      body {
        font-family:
          -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        background: #f8f9fa;
        padding: 20px;
      }
      .dashboard {
        max-width: 1400px;
        margin: 0 auto;
      }
      h1 {
        font-size: 1.75rem;
        font-weight: 700;
        margin-bottom: 1.5rem;
        color: #333;
      }
      h3 {
        font-size: 1rem;
        font-weight: 600;
        margin-bottom: 0.75rem;
        color: #444;
      }

      .dashboard-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
        margin-bottom: 1.5rem;
      }
      .stat-card {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 1.25rem;
        border-radius: 10px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }
      .stat-card.green {
        background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
      }
      .stat-card.orange {
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      }
      .stat-card.blue {
        background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
      }
      .stat-card.yellow {
        background: linear-gradient(135deg, #f5af19 0%, #f12711 100%);
      }
      .stat-card.cyan {
        background: linear-gradient(135deg, #36d1dc 0%, #5b86e5 100%);
      }
      .stat-card.purple {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      }

      .stat-value {
        font-size: 1.75rem;
        font-weight: bold;
      }
      .stat-label {
        font-size: 0.85rem;
        opacity: 0.9;
      }

      .chart-container {
        background: white;
        padding: 1.25rem;
        border-radius: 10px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.08);
        margin-bottom: 1.25rem;
      }
      .chart-row {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
        gap: 1.25rem;
        margin-bottom: 1.25rem;
      }
      .table-container {
        background: white;
        padding: 1.25rem;
        border-radius: 10px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.08);
        margin-bottom: 1.25rem;
      }
      table {
        width: 100%;
        border-collapse: collapse;
      }
      th {
        padding: 10px;
        text-align: left;
        border-bottom: 2px solid #dee2e6;
        font-weight: 600;
        font-size: 0.85rem;
        background: #f8f9fa;
      }
      td {
        padding: 10px;
        border-bottom: 1px solid #dee2e6;
        font-size: 0.9rem;
      }
      tr:hover {
        background: #f8f9fa;
      }

      .status-pending {
        background: #fff3cd;
        color: #856404;
        padding: 3px 8px;
        border-radius: 4px;
        font-size: 0.8rem;
      }
      .status-shipped {
        background: #cce5ff;
        color: #004085;
        padding: 3px 8px;
        border-radius: 4px;
        font-size: 0.8rem;
      }
      .status-delivered {
        background: #d4edda;
        color: #155724;
        padding: 3px 8px;
        border-radius: 4px;
        font-size: 0.8rem;
      }
      .status-paid {
        background: #d4edda;
        color: #155724;
        padding: 3px 8px;
        border-radius: 4px;
        font-size: 0.8rem;
      }
      .status-processing {
        background: #cce5ff;
        color: #004085;
        padding: 3px 8px;
        border-radius: 4px;
        font-size: 0.8rem;
      }

      .empty-state {
        text-align: center;
        color: #6c757d;
        padding: 30px;
      }

      .section-title {
        font-size: 1.1rem;
        font-weight: 700;
        margin-bottom: 1rem;
        color: #333;
      }
      .sidebar-link {
        display: block;
        padding: 8px 16px;
        background: #667eea;
        color: white;
        text-decoration: none;
        border-radius: 6px;
        margin-bottom: 10px;
        text-align: center;
      }
      .sidebar-link:hover {
        background: #5a6fd6;
      }
    </style>
  </head>
  <body>
    <div class="dashboard">
      <h1>MediNest Dashboard</h1>

      <!-- Quick Links -->
      <a
        href="/admin/myapp/order/"
        class="sidebar-link"
        style="display: inline-block; margin-bottom: 1.5rem"
        >ðŸ›’ Manage Orders</a
      >
      <a
        href="/admin/myapp/product/"
        class="sidebar-link"
        style="display: inline-block; margin-bottom: 1.5rem; margin-left: 10px"
        >ðŸ’Š Manage Products</a
      >
      <a
        href="/admin/myapp/prescriptionverification/"
        class="sidebar-link"
        style="display: inline-block; margin-bottom: 1.5rem; margin-left: 10px"
        >ðŸ“‹ Verify Prescriptions</a
      >
      <a
        href="/admin/myapp/userpayment/"
        class="sidebar-link"
        style="display: inline-block; margin-bottom: 1.5rem; margin-left: 10px"
        >ðŸ’° Manage Payments</a
      >
      <a
        href="/admin/myapp/customuser/"
        class="sidebar-link"
        style="display: inline-block; margin-bottom: 1.5rem; margin-left: 10px"
        >ðŸ‘¥ Manage Users</a
      >

      <div class="dashboard-grid">
        <div class="stat-card">
          <div class="stat-value">{{ total_products }}</div>
          <div class="stat-label">Total Products</div>
        </div>
        <div class="stat-card green">
          <div class="stat-value">{{ total_users }}</div>
          <div class="stat-label">Total Users</div>
        </div>
        <div class="stat-card orange">
          <div class="stat-value">{{ total_orders }}</div>
          <div class="stat-label">Total Orders</div>
        </div>
        <div class="stat-card blue">
          <div class="stat-value">NPR{{ total_revenue }}</div>
          <div class="stat-label">Total Revenue</div>
        </div>
      </div>

      <div class="dashboard-grid" style="margin-bottom: 1.5rem">
        <div class="stat-card yellow">
          <div class="stat-value">{{ pending_orders }}</div>
          <div class="stat-label">Pending Orders</div>
        </div>
        <a
          href="/admin/myapp/prescriptionverification/"
          style="text-decoration: none; color: inherit"
        >
          <div class="stat-card cyan">
            <div class="stat-value">{{ pending_prescriptions }}</div>
            <div class="stat-label">Pending Rx Verifications</div>
          </div>
        </a>
        <div class="stat-card cyan">
          <div class="stat-value">{{ shipped_orders }}</div>
          <div class="stat-label">Shipped Orders</div>
        </div>
        <div class="stat-card green">
          <div class="stat-value">{{ delivered_orders }}</div>
          <div class="stat-label">Delivered Orders</div>
        </div>
        <div class="stat-card purple">
          <div class="stat-value">{{ paid_orders }}</div>
          <div class="stat-label">Paid Orders</div>
        </div>
      </div>

      <div class="chart-row">
        <div class="chart-container">
          <h3>Sales (Last 7 Days)</h3>
          <canvas id="salesChart" height="200"></canvas>
        </div>
        <div class="chart-container">
          <h3>Order Status</h3>
          <canvas id="orderStatusChart" height="200"></canvas>
        </div>
      </div>

      <div class="chart-row">
        <div class="table-container">
          <h3 class="section-title">Recent Orders</h3>
          {% if recent_orders %}
          <table>
            <thead>
              <tr>
                <th>ID</th>
                <th>User</th>
                <th>Total</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody>
              {% for order in recent_orders %}
              <tr>
                <td>#{{ order.id }}</td>
                <td>{{ order.user.username|default:"Guest" }}</td>
                <td>NPR{{ order.total_price }}</td>
                <td>
                  <span class="status-{{ order.status }}"
                    >{{ order.status|title }}</span
                  >
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
          {% else %}
          <div class="empty-state">No orders yet</div>
          {% endif %}
        </div>

        <div class="table-container">
          <h3 class="section-title">Low Stock Products</h3>
          {% if low_stock_products %}
          <table>
            <thead>
              <tr>
                <th>Product</th>
                <th>Category</th>
                <th>Stock</th>
              </tr>
            </thead>
            <tbody>
              {% for product in low_stock_products %}
              <tr>
                <td>{{ product.name }}</td>
                <td>{{ product.category }}</td>
                <td style="color: #dc3545; font-weight: bold">
                  {{ product.stock }}
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
          {% else %}
          <div class="empty-state">All products well stocked!</div>
          {% endif %}
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        // Sales Chart
        var salesCtx = document.getElementById('salesChart').getContext('2d');
        new Chart(salesCtx, {
          type: 'line',
          data: {
            labels: {{ labels|safe }},
            datasets: [{
              label: 'Sales (NPR)',
              data: {{ sales_data|safe }},
              borderColor: '#667eea',
              backgroundColor: 'rgba(102, 126, 234, 0.1)',
              fill: true,
              tension: 0.4
            }]
          },
          options: {
            responsive: true,
            plugins: { legend: { display: false } },
            scales: {
              y: { beginAtZero: true, ticks: { callback: function(value) { return 'NPR' + value; } } }
            }
          }
        });

        // Order Status Chart
        var statusCtx = document.getElementById('orderStatusChart').getContext('2d');
        new Chart(statusCtx, {
          type: 'doughnut',
          data: {
            labels: ['Pending', 'Shipped', 'Delivered', 'Paid'],
            datasets: [{
              data: [{{ pending_orders }}, {{ shipped_orders }}, {{ delivered_orders }}, {{ paid_orders }}],
              backgroundColor: ['#f5af19', '#36d1dc', '#11998e', '#667eea']
            }]
          },
          options: {
            responsive: true,
            plugins: { legend: { position: 'bottom' } }
          }
        });
      });
    </script>
  </body>
</html>

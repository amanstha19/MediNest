{% extends "unfold/base.html" %} {% load i18n admin_urls static %} {% block
extrastyle %}
<link
  rel="stylesheet"
  href="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.css"
/>
<style>
  .dashboard-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
    gap: 1.5rem;
    margin-bottom: 2rem;
  }
  .stat-card {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 1.5rem;
    border-radius: 12px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
  }
  .stat-card.green {
    background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
  }
  .stat-card.orange {
    background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
  }
  .stat-card.blue {
    background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
  }
  .stat-value {
    font-size: 2rem;
    font-weight: bold;
  }
  .stat-label {
    opacity: 0.9;
    font-size: 0.9rem;
  }
  .chart-container {
    background: white;
    padding: 1.5rem;
    border-radius: 12px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    margin-bottom: 1.5rem;
  }
  .chart-row {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
    gap: 1.5rem;
    margin-bottom: 1.5rem;
  }
  .table-container {
    background: white;
    padding: 1.5rem;
    border-radius: 12px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  }
  .status-pending {
    background: #fff3cd;
    color: #856404;
    padding: 4px 8px;
    border-radius: 4px;
  }
  .status-shipped {
    background: #cce5ff;
    color: #004085;
    padding: 4px 8px;
    border-radius: 4px;
  }
  .status-delivered {
    background: #d4edda;
    color: #155724;
    padding: 4px 8px;
    border-radius: 4px;
  }
</style>
{% endblock %} {% block content %}
<div class="dashboard">
  <h1 style="margin-bottom: 2rem">MediNest Dashboard</h1>

  <div class="dashboard-grid">
    <div class="stat-card">
      <div class="stat-value">{{ total_products }}</div>
      <div class="stat-label">Total Products</div>
    </div>
    <div class="stat-card green">
      <div class="stat-value">{{ total_users }}</div>
      <div class="stat-label">Total Users</div>
    </div>
    <div class="stat-card orange">
      <div class="stat-value">{{ total_orders }}</div>
      <div class="stat-label">Total Orders</div>
    </div>
    <div class="stat-card blue">
      <div class="stat-value">${{ total_revenue|floatform:2 }}</div>
      <div class="stat-label">Total Revenue</div>
    </div>
  </div>

  <div class="dashboard-grid" style="margin-bottom: 2rem">
    <div
      class="stat-card"
      style="background: linear-gradient(135deg, #f5af19 0%, #f12711 100%)"
    >
      <div class="stat-value">{{ pending_orders }}</div>
      <div class="stat-label">Pending Orders</div>
    </div>
    <div
      class="stat-card"
      style="background: linear-gradient(135deg, #36d1dc 0%, #5b86e5 100%)"
    >
      <div class="stat-value">{{ shipped_orders }}</div>
      <div class="stat-label">Shipped Orders</div>
    </div>
    <div
      class="stat-card"
      style="background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%)"
    >
      <div class="stat-value">{{ delivered_orders }}</div>
      <div class="stat-label">Delivered Orders</div>
    </div>
  </div>

  <div class="chart-row">
    <div class="chart-container">
      <h3 style="margin-bottom: 1rem">Sales (Last 7 Days)</h3>
      <canvas id="salesChart" height="200"></canvas>
    </div>
    <div class="chart-container">
      <h3 style="margin-bottom: 1rem">Order Status</h3>
      <canvas id="orderStatusChart" height="200"></canvas>
    </div>
  </div>

  <div class="chart-row">
    <div class="table-container">
      <h3 style="margin-bottom: 1rem">Recent Orders</h3>
      <table style="width: 100%; border-collapse: collapse">
        <thead>
          <tr style="background: #f8f9fa">
            <th
              style="
                padding: 12px;
                text-align: left;
                border-bottom: 2px solid #dee2e6;
              "
            >
              ID
            </th>
            <th
              style="
                padding: 12px;
                text-align: left;
                border-bottom: 2px solid #dee2e6;
              "
            >
              User
            </th>
            <th
              style="
                padding: 12px;
                text-align: left;
                border-bottom: 2px solid #dee2e6;
              "
            >
              Total
            </th>
            <th
              style="
                padding: 12px;
                text-align: left;
                border-bottom: 2px solid #dee2e6;
              "
            >
              Status
            </th>
          </tr>
        </thead>
        <tbody>
          {% for order in recent_orders %}
          <tr>
            <td style="padding: 12px; border-bottom: 1px solid #dee2e6">
              #{{ order.id }}
            </td>
            <td style="padding: 12px; border-bottom: 1px solid #dee2e6">
              {{ order.user.username }}
            </td>
            <td style="padding: 12px; border-bottom: 1px solid #dee2e6">
              ${{ order.total_price }}
            </td>
            <td style="padding: 12px; border-bottom: 1px solid #dee2e6">
              <span class="status-{{ order.status }}"
                >{{ order.status|title }}</span
              >
            </td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="4" style="padding: 12px; text-align: center">
              No orders yet
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <div class="table-container">
      <h3 style="margin-bottom: 1rem">Low Stock Products</h3>
      <table style="width: 100%; border-collapse: collapse">
        <thead>
          <tr style="background: #f8f9fa">
            <th
              style="
                padding: 12px;
                text-align: left;
                border-bottom: 2px solid #dee2e6;
              "
            >
              Product
            </th>
            <th
              style="
                padding: 12px;
                text-align: left;
                border-bottom: 2px solid #dee2e6;
              "
            >
              Category
            </th>
            <th
              style="
                padding: 12px;
                text-align: left;
                border-bottom: 2px solid #dee2e6;
              "
            >
              Stock
            </th>
          </tr>
        </thead>
        <tbody>
          {% for product in low_stock_products %}
          <tr>
            <td style="padding: 12px; border-bottom: 1px solid #dee2e6">
              {{ product.name }}
            </td>
            <td style="padding: 12px; border-bottom: 1px solid #dee2e6">
              {{ product.category }}
            </td>
            <td
              style="
                padding: 12px;
                border-bottom: 1px solid #dee2e6;
                color: orange;
                font-weight: bold;
              "
            >
              {{ product.stock }}
            </td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="3" style="padding: 12px; text-align: center">
              All products well stocked!
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %} {% block extrajs %}
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script>
  document.addEventListener('DOMContentLoaded', function() {
      var salesCtx = document.getElementById('salesChart').getContext('2d');
      new Chart(salesCtx, {
          type: 'line',
          data: {
              labels: {{ labels|safe }},
              datasets: [{
                  label: 'Sales ($)',
                  data: {{ sales_data|safe }},
                  borderColor: '#667eea',
                  backgroundColor: 'rgba(102, 126, 234, 0.1)',
                  fill: true,
                  tension: 0.4
              }]
          },
          options: {
              responsive: true,
              plugins: { legend: { display: false } },
              scales: {
                  y: { beginAtZero: true, ticks: { callback: function(value) { return '$' + value; } } }
              }
          }
      });

      var statusCtx = document.getElementById('orderStatusChart').getContext('2d');
      new Chart(statusCtx, {
          type: 'doughnut',
          data: {
              labels: ['Pending', 'Shipped', 'Delivered'],
              datasets: [{
                  data: [{{ pending_orders }}, {{ shipped_orders }}, {{ delivered_orders }}],
                  backgroundColor: ['#f5af19', '#36d1dc', '#11998e']
              }]
          },
          options: { responsive: true, plugins: { legend: { position: 'bottom' } } }
      });
  });
</script>
{% endblock %}
